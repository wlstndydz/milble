{% extends 'base.html' %}
{% load static %}

{% block title %}Milble - Íµ∞Ïù∏Îì§Ïùò ÏùµÎ™Ö SNS{% endblock %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'index.css' %}">
{% endblock %}

{% block main %}
{% include 'welcome_popup.html' %}
    <main class="container">
        <h1 class="main-title">Íµ∞Ïù∏ ÏùµÎ™Ö Ïª§ÎÆ§ÎãàÌã∞ - MILBLE</h1>
        <div class="search-container">
            <input type="search" id="search-input" class="search-input" placeholder="Í¥ÄÏã¨ÏûàÎäî Ï£ºÏ†úÎ•º Í≤ÄÏÉâÌï¥Î≥¥ÏÑ∏Ïöî">
            <span class="search-icon" onclick="performSearch()">üîç</span>
            <button id="hidden-search-button" onclick="performSearch()" style="display: none;"></button>
        </div>

        <!-- Ïö∞Î¶¨Î∂ÄÎåÄ Í≤åÏãúÎ¨º ÏÑπÏÖò -->
        {% if user.is_authenticated and user.unit %}
        <div class="post-units">
            <h2>
                Ïö∞Î¶¨Î∂ÄÎåÄ
                <a href="{% url 'posts' user.unit.name %}" class="more-link">ÎçîÎ≥¥Í∏∞ ></a>
            </h2>
            <ul class="post-list">
                {% for post in user_unit_posts.popular %}
                <li class="post-item">
                    <a href="{% url 'post_detail' post.id %}" class="post-title">
                        <span>üî•&nbsp;{{ post.title }}</span>
                    </a>
                    <div class="post-stats">
                        <div class="like-stat">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="number">{{ post.likes }}</span>
                        </div>
                        <div class="comment-stat">
                            <span class="icon">üí¨</span>
                            <span class="number">{{ post.comments_count }}</span>
                        </div>
                    </div>
                </li>
                {% endfor %}
                {% for post in user_unit_posts.recent %}
                <li class="post-item">
                    <a href="{% url 'post_detail' post.id %}" class="post-title">
                        <span>{{ post.title }}</span>
                    </a>
                    <div class="post-stats">
                        <div class="like-stat">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="number">{{ post.likes }}</span>
                        </div>
                        <div class="comment-stat">
                            <span class="icon">üí¨</span>
                            <span class="number">{{ post.comments_count }}</span>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        {% endif %}


        <div class="post-units">
            <h2>
                Ï†ÑÏ≤¥
                  <a href="{% url 'popular_posts' %}" class="more-link">ÎçîÎ≥¥Í∏∞ ></a> <!-- ÎçîÎ≥¥Í∏∞ URL ÏàòÏ†ï -->
            </h2>
            <ul class="post-list">
                {% for post in popular_posts %}
                <li class="post-item">
                    <a href="{% url 'post_detail' post.id %}" class="post-title">
                        <span>{{ post.title }}</span>
                    </a>
                    <div class="post-stats">
                        <div class="like-stat">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="number">{{ post.likes }}</span>
                        </div>
                        <div class="comment-stat">
                            <span class="icon">üí¨</span>
                            <span class="number">{{ post.comments_count }}</span>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>
        
        
        <div class="post-units">
            <h2>
                ÏûêÏú†
                  <a href="{% url 'popular_posts' %}" class="more-link">ÎçîÎ≥¥Í∏∞ ></a> <!-- ÎçîÎ≥¥Í∏∞ URL ÏàòÏ†ï -->
            </h2>
            <ul class="post-list">
                {% for post in category_posts %}
                <li class="post-item">
                    <a href="{% url 'post_detail' post.id %}" class="post-title">
                        <span>{{ post.title }}</span>
                    </a>
                    <div class="post-stats">
                        <div class="like-stat">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="number">{{ post.likes }}</span>
                        </div>
                        <div class="comment-stat">
                            <span class="icon">üí¨</span>
                            <span class="number">{{ post.comments_count }}</span>
                        </div>
                    </div>
                </li>
                {% endfor %}
            </ul>
        </div>

        <div class="unit-posts">
            {% for unit, posts in unit_posts.items %}
            <div class="unit-post">
                <h3>
                    {{ unit.name }}
                     <a href="{% url 'posts' unit.name %}" class="more-link">ÎçîÎ≥¥Í∏∞ ></a> <!-- ÎçîÎ≥¥Í∏∞ Ï∂îÍ∞Ä -->
                </h3>
                <ul class="unit-post-list">
                    {% for post in posts %}
                    <li class="unit-post-item">
                        <a href="{% url 'post_detail' post.id %}" class="unit-post-title">{{ post.title }}</a>
                            <div class="views-container">
                            <span class="icon">üëÄ</span>
                            <span class="unit-post-views">{{ post.views }}</span>
                        </div>
                    </li>
                    {% endfor %}
                </ul>
            </div>
            {% endfor %}
        </div>
    </main>
<script>
    function performSearch() {
        const query = document.getElementById('search-input').value;
        if (query) {
            window.location.href = `/search/?q=` + encodeURIComponent(query);
        }
    }

    document.getElementById('search-input').addEventListener('keydown', function(event) {
        if (event.key === 'Enter') {
            performSearch();
        }
    });

</script>
{% endblock %}
