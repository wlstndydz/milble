{% extends 'base.html' %}
{% load static %}
{% load mask_filters %}

{% block title %}Milble - ê²€ìƒ‰ ê²°ê³¼{% endblock %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'posts.css' %}">
{% endblock %}

{% block main %}
    <main class="container">
        <!-- ê²€ìƒ‰ ê²°ê³¼ ì œëª© -->
        <h1 class="unit-title">
            "{{ query }}"ì— ëŒ€í•œ ê²€ìƒ‰ ê²°ê³¼
        </h1>
        
        <!-- ë¶€ëŒ€ ë° ì¹´í…Œê³ ë¦¬ ë¦¬ìŠ¤íŠ¸ì™€ ë²„íŠ¼ ì˜ì—­ ë¶„ë¦¬ -->
        <div class="units">
            <div class="units-list">
                <!-- ì „ì²´ ë²„íŠ¼ -->
                <button class="unit-btn" onclick="window.location.href='{% url 'popular_posts' %}'">ì „ì²´</button>
                
                <!-- ì‚¬ìš©ìê°€ ì†í•œ ë¶€ëŒ€ ë²„íŠ¼ -->
                {% if user.unit %}
                    {% if current_unit == user.unit %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' user.unit.name %}'">{{ user.unit.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' user.unit.name %}'">{{ user.unit.name }}</button>
                    {% endif %}
                {% endif %}
                
                <!-- ì¹´í…Œê³ ë¦¬ ë²„íŠ¼ ì¶”ê°€ -->
                {% for category in categories %}
                    {% if current_category == category %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' category.name %}'">{{ category.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' category.name %}'">{{ category.name }}</button>
                    {% endif %}
                {% endfor %}
                
                <!-- ë‹¤ë¥¸ ë¶€ëŒ€ ë²„íŠ¼ë“¤ -->
                {% for unit in units %}
                    {% if current_unit == unit %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' unit.name %}'">{{ unit.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' unit.name %}'">{{ unit.name }}</button>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        
        <!-- ê²Œì‹œë¬¼ ë¦¬ìŠ¤íŠ¸ -->
        <div class="post-list">
            {% for post in posts %}
                <div class="post-item">
                    <a href="{% url 'post_detail' post.id %}" class="post-title">{{ post.title }}</a>
                    <p class="post-content">{{ post.content|truncatewords:20 }}</p>
                    <div class="post-meta">
                        <!-- ê²Œì‹œë¬¼ì˜ unitì´ ì—†ìœ¼ë©´ categoryë¥¼ í‘œì‹œ -->
                        <div class="unit-author">
                            <span class="unit">{% if post.unit %}{{ post.unit.name }}{% else %}{{ post.category.name }}{% endif %}</span>
                            <span class="post-author">{{ post.author|mask_author }}</span>
                        </div>
                        <div class="post-stats">
                            <div class="like-stat">
                                <span class="icon">â¤ï¸</span>
                                <span class="number">{{ post.likes }}</span>
                            </div>
                            <div class="comment-stat">
                                <span class="icon">ğŸ’¬</span>
                                <span class="number">{{ post.comments.count }}</span>
                            </div>
                            <div class="views-stat">
                                <span class="icon">ğŸ‘€</span>
                                <span class="number">{{ post.views }}</span>
                            </div>
                        </div>
                    </div>
                </div>
            {% empty %}
                <p>ê²€ìƒ‰ì–´ì— í•´ë‹¹í•˜ëŠ” ê²Œì‹œë¬¼ì´ ì—†ìŠµë‹ˆë‹¤.</p>
            {% endfor %}
        </div>
    </main>
{% endblock %}
