{% extends 'base.html' %}
{% load static %}
{% load mask_filters %}

{% block title %}Milble - Í≤åÏãúÌåê{% endblock %}

{% block head %}
    <link rel="stylesheet" type="text/css" href="{% static 'posts.css' %}">
{% endblock %}

{% block main %}
    <main class="container">
        <!-- ÌòÑÏû¨ Î∂ÄÎåÄ ÎòêÎäî Ïπ¥ÌÖåÍ≥†Î¶¨ Ïù¥Î¶ÑÏùÑ ÌëúÏãú -->
        <h1 class="unit-title">
            {% if current_unit %}{{ current_unit.name }}{% elif current_category %}{{ current_category.name }}{% else %}Ï†ÑÏ≤¥ Í≤åÏãúÌåê{% endif %}
        </h1>
        
        <!-- Î∂ÄÎåÄ Î∞è Ïπ¥ÌÖåÍ≥†Î¶¨ Î¶¨Ïä§Ìä∏ÏôÄ Î≤ÑÌäº ÏòÅÏó≠ Î∂ÑÎ¶¨ -->
        <div class="units">
            <div class="units-list">
                <!-- Ï†ÑÏ≤¥ Î≤ÑÌäº -->
                <button class="unit-btn" onclick="window.location.href='{% url 'popular_posts' %}'">Ï†ÑÏ≤¥</button>
                
                <!-- ÏÇ¨Ïö©ÏûêÍ∞Ä ÏÜçÌïú Î∂ÄÎåÄ Î≤ÑÌäº -->
                {% if user.unit %}
                    {% if current_unit == user.unit %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' user.unit.name %}'">{{ user.unit.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' user.unit.name %}'">{{ user.unit.name }}</button>
                    {% endif %}
                {% endif %}
                
                <!-- Ïπ¥ÌÖåÍ≥†Î¶¨ Î≤ÑÌäº Ï∂îÍ∞Ä -->
                {% for category in categories %}
                    {% if current_category == category %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' category.name %}'">{{ category.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' category.name %}'">{{ category.name }}</button>
                    {% endif %}
                {% endfor %}
                
                <!-- Îã§Î•∏ Î∂ÄÎåÄ Î≤ÑÌäºÎì§ -->
                {% for unit in units %}
                    {% if current_unit == unit %}
                        <button class="selected-unit-btn" onclick="window.location.href='{% url 'posts' unit.name %}'">{{ unit.name }}</button>
                    {% else %}
                        <button class="unit-btn" onclick="window.location.href='{% url 'posts' unit.name %}'">{{ unit.name }}</button>
                    {% endif %}
                {% endfor %}
            </div>
        </div>
        
        <!-- Í≤åÏãúÎ¨º Î¶¨Ïä§Ìä∏ -->
        <div class="post-list">
            {% for post in posts %}
            <div class="post-item">
                <a href="{% url 'post_detail' post.id %}" class="post-title">{{ post.title }}</a>
                <p class="post-content">{{ post.content|truncatewords:20 }}</p>
                <div class="post-meta">
                    <!-- Í≤åÏãúÎ¨ºÏùò unitÏù¥ ÏóÜÏúºÎ©¥ categoryÎ•º ÌëúÏãú -->
                    <div class="unit-author">
                        <span class="unit">{% if post.unit %}{{ post.unit.name }}{% else %}{{ post.category.name }}{% endif %}</span>
                        <span class="post-author">{{ post.author|mask_author }}</span>
                    </div>
                    <div class="post-stats">
                        <div class="like-stat">
                            <span class="icon">‚ù§Ô∏è</span>
                            <span class="number">{{ post.likes }}</span>
                        </div>
                        <div class="comment-stat">
                            <span class="icon">üí¨</span>
                            <span class="number">{{ post.comments.count }}</span>
                        </div>
                        <div class="views-stat">
                            <span class="icon">üëÄ</span>
                            <span class="number">{{ post.views }}</span>
                        </div>
                    </div>

                </div>
            </div>
            {% empty %}
            
            {% endfor %}
        </div>
    </main>
{% endblock %}
